/*==============================================================================
 ___  _   _    _
/   || | | |  | |
\__  | | | |  | |  __
/    |/  |/_) |/  /  \_/\/
\___/|__/| \_/|__/\__/  /\_/
              |\
              |/
Focus v1.3
https://github.com/Elkfox/Focus
Copyright (c) 2017 Elkfox Co Pty Ltd
https://elkfox.com
Project lead: George Butter
MIT License
==============================================================================*/
var Focus=function(e,t){if(this.target=e,this.element=jQuery(e),this.config={visibleClass:"visible",bodyClass:"active-popup",innerSelector:".popup-inner",popupContent:".popup-content",avoidSubpixels:!1,autoFocusSelector:"[data-auto-focus]"},t)for(var i in t)this.config[i]=t[i];this.visible=!1,this.width=jQuery(this.config.popupContent).outerWidth(),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),Focus.elements[e]=this};Focus.elements={},Focus.getTarget=function(e,t){jQuery(e).is("a")&&t.preventDefault();const i=this.getSelectorFromElement(e);return target=i?i:null,target},Focus.getSelectorFromElement=function(e){var t=jQuery(e).data("target");return t&&"#"!==t||(t=jQuery(e).attr("href")||null),t},Focus.eventHandler=function(e,t){var i=Focus.elements[e];if(!i)var i=new Focus(e);"hide"===t?i.hide():i.toggle()},Focus.prototype.verticalAlign=function(){var e=this;if(e.config.avoidSubpixels){var t=Math.round(jQuery(this.target).find(e.config.popupContent).outerHeight()/2),i=Math.round($(window).height()/2);jQuery(this.target).find(e.config.popupContent).css("top",i-t).css("transform","translateY(0)")}},Focus.prototype.show=function(){var e=this;return this.visible&&this.element.hasClass(this.config.visibleClass)?jQuery(document).trigger("focus:error",{error:"Popup already open"}):(this.element.addClass(this.config.visibleClass),jQuery("body").addClass(this.config.bodyClass),this.visible=!0,e.verticalAlign(),jQuery(this.target+" "+this.config.autoFocusSelector).length&&setTimeout(function(){jQuery(e.target+" "+e.config.autoFocusSelector).focus()},300),this.element.on("click","[data-close]",function(t){t.preventDefault(),e.hide()}),this.element.on("click",this.config.innerSelector,function(t){(jQuery(t.target).is(e.config.innerSelector)||0===jQuery(t.target).parents(e.config.target).length)&&e.hide()}),jQuery(document).on("keyup",this.element,function(t){27===t.keyCode&&(jQuery(document).off("keyup",this.element),e.hide())}),jQuery(document).trigger("focus:open",[this.target]))},Focus.prototype.hide=function(){return this.visible||this.element.hasClass(this.config.visibleClass)?(this.element.removeClass(this.config.visibleClass),jQuery("body").removeClass(this.config.bodyClass),this.config.avoidSubpixels&&jQuery(this.target).find(this.config.popupContent).removeAttr("style"),this.element.off("click",this.config.innerSelector),this.element.off("click","[data-close]"),this.visible=!1,jQuery(document).trigger("focus:close",[this.target])):jQuery(document).trigger("focus:error",{error:"Focus element is already closed"})},Focus.prototype.toggle=function(){return this.visible?this.hide():this.show()},jQuery(document).ready(function(){jQuery(".popup:not(.sticky)").detach().appendTo("body"),jQuery(document).on("click",'[data-trigger="popup"]',function(e){var t=Focus.getTarget(jQuery(this),e);Focus.eventHandler(t,"toggle")}),jQuery(document).on("click","[data-close]",function(e){var t=Focus.getTarget(jQuery(this),e);t&&Focus.eventHandler(t,"hide")})}),jQuery(window).resize(function(){for(var e in Focus.elements)Focus.elements[e].visible&&Focus.elements[e].verticalAlign()});
